{% extends "layout.html" %}

{% block body %}

{% if user %}
<nav class="frontpage-actions">
	<a href="{{uri_for('blog-newpost')}}" class="frontpage-actions-link add-post">Add post</a>
</nav>
{% endif %}

{% if posts %}
	{% for post in posts %}
		{% set post_id = post.key.id() %}
		{% set author = users_dict[post.author] %}
		{% set uri = uri_for('blog-onepost', post_id=post_id ) %}
		{% set user_is_author = user is defined and (post.author.id() == user.user_id) %}
<article>
	<h2 class="blog-title">
		<a href="{{uri}}">
			{{post.title|striptags|e}}
		</a>
	</h2>
	<p class="blog-date">{{post.created.strftime('%B %d, %Y') }}</p>
	<p class="blog-author">
		{% if user_is_author %}
		<span class="name">by <em>You</em></span><a href="{{uri}}/edit">edit</a></p>
		{% else %}
		<img class='avatar' src="/img/ava/{{author['avatar']}}">
		<span class="name">by <em>{{author['name']}}</em></span></p>
		{% endif %}
	<div class="article-contents">
	{{post.content|safe}}
	</div> 
	<div class="article-info">
		{% if post.score is defined and not user_is_author %}
			{% include 'snippets/score.html' %}
		{% endif %}
		
		<p class="blog-comments"><a href="{{uri}}">
		{%if post.comments %}
			{{ post.comments|count }} comments
		{% else %}
			Comment
		{% endif %}
		</a></p>
	</div>
</article>
	{% endfor %}
{% else %}
<p>The blog is empty.</p>
{% endif %}
{% endblock %}
